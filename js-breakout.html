<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breakout</title>
</head>

<body>
    <script>
        // game parameters
        const HEIGHT = 550; // pixels
        const PADDLE_SPD = 0.7; // fraction of the screen width per second
        const BALL_SPD = 0.5; // starting ball speed as a fraction of the screen width per second

        // derived dimensions
        const WIDTH = HEIGHT * 0.9;
        const WALL = WIDTH / 50;
        const PADDLE_H = WALL;
        const BALL_SIZE = WALL;
        const PADDLE_W = PADDLE_H * 5;

        // colours
        const COLOR_BACKGROUND = "black";
        const COLOR_BALL = "white";
        const COLOR_PADDLE = "white";
        const COLOR_WALL = "grey";


        // definitions
        const Direction = {
            LEFT: 0,
            RIGHT: 1,
            STOP: 2
        }


        // set up the game canvas
        var canv = document.createElement("canvas");
        canv.width = WIDTH;
        canv.height = HEIGHT;
        document.body.appendChild(canv);

        // set up the context
        var ctx = canv.getContext("2d");
        ctx.lineWidth = WALL;

        // game variables
        var paddle, ball;


        // star a new game
        newGame();

        // event listeners
        document.addEventListener("keydown", keyDown);
        document.addEventListener("keyup", keyUp);

        // set up the game loop
        var timeDelta, timeLast;
        requestAnimationFrame(loop);

        function loop(timeNow) {
            if (!timeLast) {
                timeLast = timeNow;
            }

            // calculate the time difference
            timeDelta = (timeNow - timeLast) / 1000; // in seconds
            timeLast = timeNow;

            // update the game state
            updatePaddle(timeDelta);

            // draw the game
            drawBackground();
            draWalls();
            drawPaddle();
            drawBall();


            // call the next loop
            requestAnimationFrame(loop);
        }

        function drawBackground() {
            ctx.fillStyle = COLOR_BACKGROUND;
            ctx.fillRect(0, 0, canv.width, canv.height);
        }

        function drawBall() {
            ctx.fillStyle = COLOR_BALL;
            ctx.fillRect(ball.x - ball.w * 0.5, ball.y - ball.h * 0.5, ball.w, ball.h);
        }

        function drawPaddle() {
            ctx.fillStyle = COLOR_PADDLE;
            ctx.fillRect(paddle.x - paddle.w * 0.5, paddle.y - paddle.h * 0.5, paddle.w, paddle.h);
        }

        function draWalls() {
            let hwall = WALL * 0.5;
            ctx.strokeStyle = COLOR_WALL;
            ctx.beginPath();
            ctx.moveTo(hwall, HEIGHT);
            ctx.lineTo(hwall, hwall);
            ctx.lineTo(WIDTH - hwall, hwall);
            ctx.lineTo(WIDTH - hwall, HEIGHT);
            ctx.stroke();

        }

        function keyDown(ev) {
            switch (ev.keyCode) {
                case 37: // left arrow (move paddle left)
                    movePaddle(Direction.LEFT);
                    break;
                case 39: // right arrow (move paddle right)
                    movePaddle(Direction.RIGHT);
                    break;
            }
        }

        function keyUp(ev) {
            switch (ev.keyCode) {
                case 37: // left arrow (stop moving)
                case 39: // right arrow (stop moving)
                    movePaddle(Direction.STOP);
                    break;
            }
        }

        function movePaddle(direction) {
            switch (direction) {
                case Direction.LEFT:
                    paddle.xv = -paddle.spd;
                    break;
                case Direction.RIGHT:
                    paddle.xv = paddle.spd;
                    break;
                case Direction.STOP:
                    paddle.xv = 0;
                    break;
            }
        }

        function newGame() {
            paddle = new Paddle();
            ball = new Ball();
        }

        function updatePaddle(delta) {
            paddle.x += paddle.xv * delta;

            // stop paddle at walls
            if (paddle.x < WALL + paddle.w * 0.5) {
                paddle.x = WALL + paddle.w * 0.5;
            } else if (paddle.x > WIDTH - WALL - paddle.w * 0.5) {
                paddle.x = WIDTH - WALL - paddle.w * 0.5;
            }
        }

        function Ball() {
            this.w = BALL_SIZE;
            this.h = BALL_SIZE;
            this.x = paddle.x;
            this.y = paddle.y - paddle.h / 2 - this.h / 2;
            this.spd = BALL_SPD * WIDTH;
            this.xv = 0;
            this.yv = 0;
        }

        function Paddle() {
            this.w = PADDLE_W;
            this.h = PADDLE_H;
            this.x = canv.width / 2;
            this.y = canv.height - this.h * 3;
            this.xv = 0;
            this.spd = PADDLE_SPD * WIDTH;
        }

    </script>
</body>

</html>